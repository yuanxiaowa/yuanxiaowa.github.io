(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["svn-id"],{"7d34":function(t,e){},"9db4":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("v-layout",{staticClass:"pa-3"},[a("v-flex",[t._v("\n      "+t._s(t.path)+"\n    ")]),a("v-btn",{attrs:{small:"",color:"primary"},on:{click:function(e){return t.showLog(t.path,!1)}}},[t._v("查看日志")])],1),a("v-tabs",{model:{value:t.tab,callback:function(e){t.tab=e},expression:"tab"}},[a("v-tab",{attrs:{href:"#tab-1"}},[t._v("本地")]),a("v-tab",{attrs:{href:"#tab-2"}},[t._v("合并")])],1),a("v-tabs-items",{model:{value:t.tab,callback:function(e){t.tab=e},expression:"tab"}},[a("v-tab-item",{attrs:{value:"tab-1"}},[a("svn-local",{ref:"sl",attrs:{path:t.path},on:{"show-log":t.showLog,message:t.onMessage}})],1),a("v-tab-item",{attrs:{value:"tab-2"}},[a("keep-alive",["tab-2"===t.tab?a("svn-merge",{attrs:{path:t.path,url:t.url},on:{message:t.onMessage,merged:t.onMerged}}):t._e()],1)],1)],1),a("v-expansion-panel",{staticClass:"mt-3"},[a("v-expansion-panel-content",[a("div",{attrs:{slot:"header"},slot:"header"},[t._v("日志")]),a("v-card",{attrs:{dark:""}},[t.logs.length>0?a("v-card-actions",[a("v-spacer"),a("v-btn",{attrs:{flat:"",icon:"",color:"red"},on:{click:t.clearLogs}},[a("v-icon",[t._v("cancel")])],1)],1):t._e(),0===t.logs.length?a("v-card-title",[t._v("暂无记录")]):t._e(),t._l(t.logs,function(e,s){return a("v-card-text",{key:s},[a("v-layout",[a("v-flex",t._l(e.items,function(e,s){return a("div",{key:s},[t._v("\n                "+t._s(e)+"\n              ")])}),0),a("div",[t._v("\n              "+t._s(t._f("date")(e.date))+"\n            ")])],1),a("v-divider")],1)})],2)],1)],1),a("my-dialog",{attrs:{"max-width":"800px",title:"修改记录"},model:{value:t.show_log,callback:function(e){t.show_log=e},expression:"show_log"}},[a("div",[t._v("文件路径："+t._s(t.log_path))]),a("svn-log",{attrs:{path:t.log_path,"remote-base":t.log_remote_base}})],1)],1)},i=[],r=a("9ab4"),o=a("60a3"),n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("v-card",[a("v-card-actions",[a("v-spacer"),a("v-tooltip",{attrs:{top:""}},[a("v-btn",{attrs:{slot:"activator",icon:""},on:{click:t.update},slot:"activator"},[a("v-icon",[t._v("arrow_downward")])],1),a("span",[t._v("更新")])],1),a("v-tooltip",{attrs:{top:""}},[a("v-btn",{attrs:{slot:"activator",icon:""},on:{click:t.refresh},slot:"activator"},[a("v-icon",[t._v("refresh")])],1),a("span",[t._v("刷新")])],1)],1),a("v-card-text",[a("v-data-table",{attrs:{headers:t.headers,items:t.items,"select-all":"primary",loading:t.loading,"item-key":"path",pagination:t.pagination},on:{"update:pagination":function(e){t.pagination=e}},scopedSlots:t._u([{key:"items",fn:function(e){return[a("td",[a("v-checkbox",{attrs:{primary:"","hide-details":"",color:"primary"},model:{value:e.selected,callback:function(a){t.$set(e,"selected",a)},expression:"props.selected"}})],1),a("td",["added"!==e.item.type&&"unversioned"!==e.item.type?a("a",{attrs:{color:"primary"},on:{click:function(a){return t.$emit("show-log",e.item.path)}}},[t._v("\n              "+t._s(e.item.path)+"\n            ")]):a("div",[t._v(t._s(e.item.path))])]),a("td",{staticClass:"text-xs-center"},[t._v(t._s(e.item.type))]),a("td",{staticClass:"text-xs-center"},[t._v(t._s(e.item.revision))]),a("td",[e.item.commit?a("div",[t._v("\n              提交者："+t._s(e.item.commit.author)+" "),a("br"),t._v(" 时间："+t._s(t._f("date")(e.item.commit.date))+"\n              "),a("br"),t._v(" 版本："+t._s(e.item.commit.revision)+"\n            ")]):t._e()]),a("td",{staticClass:"text-xs-right"},[a("v-icon",{attrs:{disabled:!("unversioned"!==e.item.type&&!e.item.hasConflict),color:"green"},on:{click:function(a){return t.commit([e.item.path])}}},[t._v("arrow_upward")]),a("v-icon",{attrs:{disabled:"unversioned"!==e.item.type,color:"green"},on:{click:function(a){return t.add([e.item.path])}}},[t._v("add")]),a("v-icon",{attrs:{disabled:!e.item.hasConflict,color:"warn"},on:{click:function(a){return t.resolve([e.item.path])}}},[t._v("check")]),a("v-icon",{attrs:{disabled:"added"===e.item.type||"unversioned"===e.item.type,color:"red"},on:{click:function(a){return t.del([e.item.path])}}},[t._v("delete")])],1)]}}]),model:{value:t.selected,callback:function(e){t.selected=e},expression:"selected"}},[a("v-layout",{attrs:{slot:"actions-prepend","align-center":""},slot:"actions-prepend"},[a("v-text-field",{attrs:{placeholder:"注释"},model:{value:t.msg,callback:function(e){t.msg=e},expression:"msg"}}),t.has_new?a("v-tooltip",{attrs:{top:""}},[a("v-btn",{attrs:{slot:"activator",icon:"",flat:"",small:"",color:"green"},on:{click:t.addSelected},slot:"activator"},[a("v-icon",[t._v("add")])],1),a("span",[t._v("添加选中")])],1):t._e(),a("v-tooltip",{attrs:{top:""}},[a("v-btn",{attrs:{slot:"activator",icon:"",flat:"",small:"",color:"green"},on:{click:t.commitSelected},slot:"activator"},[a("v-icon",[t._v("arrow_upward")])],1),a("span",[t._v("提交选中")])],1)],1)],1)],1)],1)],1)},l=[],c=a("9530"),h=a.n(c);let p=class extends o["d"]{constructor(){super(...arguments),this.selected=[],this.pagination={rowsPerPage:10},this.headers=[{text:"路径",value:"path",align:"left"},{text:"状态",value:"type",align:"center"},{text:"版本",value:"revision",align:"center"},{text:"上次提交",value:"path",align:"left"},{text:"操作",value:"path",align:"right"}],this.items=[],this.loading=!1,this.msg=""}created(){this.fetchData()}get has_new(){return!!this.selected.find(t=>"unversioned"===t.type)}commitSelected(){if(!this.selected.length)return this.$toast("请选择提交项");if(!this.msg)return this.$toast("请输入注释");var t=this.selected.map(t=>t.path);this.commit(t)}addSelected(){}async handle(t,e){var a=await this.$apollo.mutate({mutation:e,variables:{paths:t,cwd:this.path,msg:this.msg}}),s=a.data;this.$emit("message",s[Object.keys(s)[0]]),this.refresh()}update(){return this.handle([],h.a`mutation($paths:[String]!, $cwd:String){
        svnUpdate(paths:$paths, cwd:$cwd)
      }`)}add(t){return this.handle(t,h.a`mutation($paths:[String]!, $cwd:String){
        svnAdd(paths:$paths, cwd:$cwd)
      }`)}commit(t){return this.handle(t,h.a`mutation($paths:[String]!, $cwd:String, $msg:String!){
        svnCommit(paths:$paths, cwd:$cwd, msg:$msg)
      }`)}revert(t){return this.handle(t,h.a`mutation($paths:[String]!, $cwd:String){
        svnRevert(paths:$paths, cwd:$cwd)
      }`)}resolve(t){return this.handle(t,h.a`mutation($paths:[String]!, $cwd:String){
        svnResolve(paths:$paths, cwd:$cwd)
      }`)}async del(t){return await this.$confirm("确定要删除吗？"),this.handle(t,h.a`mutation($paths:[String]!, $cwd:String){
        svnDel(paths:$paths, cwd:$cwd)
      }`)}async fetchData(){this.loading=!0;try{var t=await this.$apollo.query({query:h.a`query($path:String!) {
        svnStatus(cwd: $path) {
          path
          type
          revision
          hasConflict
          commit {
            author
            date
            revision
          }
        }
      }`,variables:{path:this.path}}),e=t.data.svnStatus;this.items=this.selected=e}catch(a){}this.loading=!1}refresh(){return this.fetchData()}};r["b"]([Object(o["c"])(String)],p.prototype,"path",void 0),p=r["b"]([o["a"]],p);var d=p,v=d,u=a("2877"),g=Object(u["a"])(v,n,l,!1,null,null,null),m=g.exports,f=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-card",[a("v-card-text",[a("v-radio-group",{attrs:{row:""},model:{value:t.type,callback:function(e){t.type=e},expression:"type"}},t._l(t.radios,function(t,e){return a("v-radio",{key:t,attrs:{label:t,value:e}})}),1),a("v-autocomplete",{attrs:{items:t.structures[t.type],"item-text":"name","item-value":"fullPath",placeholder:"请选择分支"},model:{value:t.selected_item,callback:function(e){t.selected_item=e},expression:"selected_item"}}),a("v-layout",[a("v-spacer"),a("v-btn",{attrs:{small:"",icon:""},on:{click:t.refreshLog}},[a("v-icon",[t._v("refresh")])],1)],1),a("svn-log",{ref:"sl",attrs:{path:t.selected_item,"merge-info":t.mergeInfo},model:{value:t.selected,callback:function(e){t.selected=e},expression:"selected"}}),a("div",{staticStyle:{"margin-top":"-4em"}},[a("v-btn",{attrs:{color:"primary",disabled:0===t.selected.length,loading:t.merging},on:{click:t.merge}},[t._v("合并")])],1)],1)],1)},b=[],_=a("2638"),y=a.n(_),$=a("3f7a");let w=class extends o["d"]{constructor(){super(...arguments),this.show=!1,this.files=[],this.items=[],this.pagination={page:1,rowsPerPage:10},this.total=0,this.loading=!1,this.headers=[{text:"版本",value:"revision"},{text:"备注",value:"msg"},{text:"提交者",value:"author"},{text:"提交时间",value:"date"},{text:"查看文件",value:"revision"}],this.query=h.a`query($path:String!, $page: Int){
    svnLog(path: $path, page: $page) {
      page,
      total,
      items {
        revision
        author
        date
        msg
        paths {
          kind
          action
          path
        }
      }
    }
  }`}showFiles(t){this.show=!0,this.files=t.map(t=>{let e=t.path,a=t.kind,s=t.action;return{kind:a,action:s,path:e}})}onPathChange(t){this.items=[],this.total=0,1===this.pagination.page?this.fetchData(1):this.pagination.page=1}input(t){}refresh(){return this.fetchData(this.pagination.page)}async fetchData(t){if(this.path){this.loading=!0;var e=await this.$apollo.query({query:this.query,variables:{path:this.path,page:t}}),a=e.data.svnLog,s=(a.page,a.items),i=a.total;this.items=s.map(t=>{return t.msg=t.msg.split(/\r?\n/),t}),this.input([]),this.total=i,this.loading=!1}}onPagination(t){this.pagination=t,this.fetchData(t.page)}render(){const t=arguments[0];var e={props:{"select-all":!!this.mergeInfo&&"primary"},on:{"update:pagination":this.onPagination},scopedSlots:{items:e=>{var a=e.item,s=[t("td",[" ",a.revision," "]),t("td",[a.msg.map((e,a)=>t("div",{key:a},[" ",e," "]))]),t("td",[a.author," "]),t("td",[o["d"].filter("date")(a.date)," "]),t("td",[t("v-icon",{on:{click:()=>this.showFiles(a.paths)}},["filter_tilt_shif t "])])];return this.mergeInfo&&(this.mergeInfo.includes(a.revision)&&(s[0]=t("td",{attrs:{title:"已合并"}},[t("v-badge",{attrs:{color:"purple",left:!0}},[t("v-icon",{slot:"badge",attrs:{dark:!0,small:!0}},["alarm_off"]),a.revision])])),s.unshift(t("td",[t("v-checkbox",{attrs:{"input-value":e.selected,color:"primary"},on:{change:t=>e.selected=t}})]))),s}}};return this.mergeInfo&&(e.props.value=this.value,e.o.input=this.input),t("div",[t("v-data-table",y()([{},e,{attrs:{items:this.items,headers:this.headers,pagination:this.pagination,loading:this.loading,"total-items":this.total,"item-key":"revision"}}])),t("my-dialog",{on:{input:t=>this.show=t},attrs:{value:this.show,"max-width":"800px"}},[t("v-list",[this.files.map(e=>t("v-list-tile",{key:e.path},[t("v-list-tile-action",["dir"===e.kind?t("v-icon",{attrs:{color:"amber"}},["folder"]):t("v-icon",{attrs:{color:"indigo"}},["mdi-file"])]),t("v-list-tile-content",[e.path])]))])])])}};r["b"]([Object(o["c"])(String)],w.prototype,"path",void 0),r["b"]([Object(o["c"])(String)],w.prototype,"remoteBase",void 0),r["b"]([Object(o["c"])()],w.prototype,"mergeInfo",void 0),r["b"]([Object(o["c"])()],w.prototype,"value",void 0),r["b"]([Object(o["e"])("path")],w.prototype,"onPathChange",null),r["b"]([Object(o["b"])()],w.prototype,"input",null),w=r["b"]([Object(o["a"])({components:{MyDialog:$["a"]}})],w);var x,k,S=w,j=S,I=Object(u["a"])(j,x,k,!1,null,null,null),O=I.exports;let q=class extends o["d"]{constructor(){super(...arguments),this.fields=[],this.radios=["branches","tags","trunk"],this.type=0,this.structures=[],this.selected_item="",this.mergeInfo=[],this.selected=[],this.merging=!1}created(){this.getStructure()}refreshLog(){var t=this.$refs.sl;t.refresh()}async merge(){var t=this.selected.map(t=>t.revision).sort((t,e)=>t-e);this.$emit("message","开始合并"),this.merging=!0;try{var e=await this.$apollo.mutate({mutation:h.a`mutation($path: String!, $url: String!, $revisions: [Int]!){
        svnMerge(path: $path, url: $url, revisions: $revisions)
      }`,variables:{path:this.path,url:this.selected_item,revisions:t}}),a=e.data.svnMerge;this.getMergeInfo(this.selected_item),this.$emit("message",a),this.$emit("merged"),this.$toast("合并成功"),this.selected=[]}catch(s){}this.merging=!1}async getMergeInfo(t){this.mergeInfo=[];var e=await this.$apollo.query({query:h.a`query($path: String!,$url: String!) {
        svnMergeInfo(path: $path, url: $url)
      }`,variables:{path:this.path,url:t}}),a=e.data.svnMergeInfo;this.mergeInfo=a}async getStructure(){var t=await this.$apollo.query({query:h.a`query($path: String!) {
        svnStructure(path: $path) {
          name
          fullPath
          type
          commit {
            author
            date
            revision
          }
        }
      }`,variables:{path:this.url}}),e=t.data.svnStructure;this.structures=e}};r["b"]([Object(o["c"])(String)],q.prototype,"path",void 0),r["b"]([Object(o["c"])(String)],q.prototype,"url",void 0),r["b"]([Object(o["c"])(String)],q.prototype,"root",void 0),r["b"]([Object(o["e"])("selected_item")],q.prototype,"getMergeInfo",null),r["b"]([Object(o["e"])("url")],q.prototype,"getStructure",null),q=r["b"]([Object(o["a"])({components:{SvnLog:O}})],q);var M=q,L=M,C=Object(u["a"])(L,f,b,!1,null,null,null),D=C.exports;let P=class extends o["d"]{constructor(){super(...arguments),this.tab="tab-1",this.logs=[],this.log_path="",this.log_remote_base="",this.show_log=!1,this.remote_base="",this.url="",this.root=""}created(){this.getInfo()}onMerged(){var t=this.$refs.sl;t.refresh()}showLog(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var a,s;this.show_log=!0,"string"===typeof t?(a=t,s=this.remote_base,e&&(a=this.path+"/"+a)):(a=t.path,s=t.remote_base),this.log_path=a,this.log_remote_base=s}get path(){return this.$route.params.id}onMessage(t){this.logs.unshift({date:new Date,items:t.split(/\r?\n/)})}async getInfo(){var t=await this.$apollo.query({query:h.a`query($path:String!){
        svnInfo(path:$path) {
          url,
          repository {
            root
          }
        }
      }`,variables:{path:this.path}}),e=t.data.svnInfo,a=e.url,s=e.repository.root;this.url=a,this.root=s,this.remote_base=a.replace(s,"")}clearLogs(){this.logs=[]}};P=r["b"]([Object(o["a"])({components:{SvnLocal:m,SvnMerge:D,SvnLog:O,MyDialog:$["a"]}})],P);var E=P,F=E,J=a("7d34"),R=a.n(J),A=Object(u["a"])(F,s,i,!1,null,null,null);"function"===typeof R.a&&R()(A);e["default"]=A.exports}}]);